<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GAN Training</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
    <h1>GAN Training Configuration</h1>
    <form id="config-form">
        <h3>Optimizer</h3>
        <label for="optimizer">Optimizer:</label>
        <select id="optimizer" name="optimizer">
            {% for key, value in Optimizer.__members__.items() %}
                <option value="{{ key }}" {% if key == cfg.optimizer.name %} selected {% endif %}>
                    {{ key }}
                </option>
            {% endfor %}
        </select>
        <div id="adam-params" style="display: {% if cfg.optimizer == Optimizer.ADAM %}block{% else %}none{% endif %};">
            <label for="adam_beta1">Beta 1:</label>
            <input type="number" step="0.001" id="adam_beta1" name="adam_beta1" value="{{ cfg.adam_beta1 }}">
            <label for="adam_beta2">Beta 2:</label>
            <input type="number" step="0.001" id="adam_beta2" name="adam_beta2" value="{{ cfg.adam_beta2 }}">
        </div>
        <label for="learn_rate">Learning Rate:</label>
        <input type="number" step="0.00001" id="learn_rate" name="learn_rate" value="{{ cfg.learn_rate }}">

        <h3>Model</h3>
        <label for="noise_size">Noise Size:</label>
        <input type="number" id="noise_size" name="noise_size" value="{{ cfg.noise_size }}">
        <label for="conditional">Conditional:</label>
        <input type="checkbox" id="conditional" name="conditional" {% if cfg.conditional %} checked {% endif %}>

        <h3>Training</h3>
        <label for="batch_size">Batch Size:</label>
        <input type="number" id="batch_size" name="batch_size" value="{{ cfg.batch_size }}">
        <label for="num_epochs">Number of Epochs:</label>
        <input type="number" id="num_epochs" name="num_epochs" value="{{ cfg.num_epochs }}">
        <label for="strategy">Strategy:</label>
        <select id="strategy" name="strategy">
            {% for key, value in Strategy.__members__.items() %}
                <option value="{{ key }}" {% if key == cfg.strategy.name %} selected {% endif %}>
                    {{ key }}
                </option>
            {% endfor %}
        </select>
        <div id="clip-value" style="display: {% if cfg.strategy == Strategy.CLIP_WEIGHT %}block{% else %}none{% endif %};">
            <label for="clip_value">Clip Value:</label>
            <input type="number" step="0.01" id="clip_value" name="clip_value" value="{{ cfg.clip_value }}">
        </div>
        <div id="gp-lambda" style="display: {% if cfg.strategy == Strategy.GRAD_PENALTY %}block{% else %}none{% endif %};">
            <label for="gp_lambda">Lambda:</label>
            <input type="number" id="gp_lambda" name="gp_lambda" value="{{ cfg.gp_lambda }}">
        </div>
        <button type="button" id="update-config">Update Configuration</button>
        <button type="button" id="start-training">Start Training</button>
        <button type="button" id="stop-training">Stop Training</button>
    </form>
    <h2>Generated Images</h2>
    <div id="images"></div>

    <script>
        function updateFields() {
            const optimizer = $('#optimizer').val();
            if (optimizer === 'ADAM') {
                $('#adam-params').show();
            } else {
                $('#adam-params').hide();
            }

            const strategy = $('#strategy').val();
            if (strategy === 'CLIP_WEIGHT') {
                $('#clip-value').show();
                $('#gp-lambda').hide();
            } else if (strategy === 'GRAD_PENALTY') {
                $('#clip-value').hide();
                $('#gp-lambda').show();
            } else {
                $('#clip-value').hide();
                $('#gp-lambda').hide();
            }
        }

        $('#optimizer').change(updateFields);
        $('#strategy').change(updateFields);
        updateFields();

        $('#update-config').click(function() {
            const formData = $('#config-form').serializeArray();
            const configData = {};
            formData.forEach(field => configData[field.name] = field.value);
            configData['conditional'] = $('#conditional').is(':checked');

            $.ajax({
                url: '/update_config',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(configData),
                success: function(response) {
                    alert('Configuration updated successfully!');
                },
                error: function() {
                    alert('Failed to update configuration.');
                }
            });
        });

        $('#start-training').click(function() {
            $.ajax({
                url: '/start_training',
                type: 'POST',
                success: function(response) {
                    alert('Training started successfully!');
                },
                error: function() {
                    alert('Failed to start training.');
                }
            });
        });

        $('#stop-training').click(function() {
            $.ajax({
                url: '/stop_training',
                type: 'POST',
                success: function(response) {
                    alert('Training stopped successfully!');
                },
                error: function() {
                    alert('Failed to stop training.');
                }
            });
        });

        function loadImages() {
            $.ajax({
                url: '/get_images',
                type: 'GET',
                success: function(response) {
                    const images = response.images;
                    $('#images').empty();
                    images.forEach(img => {
                        $('#images').append(`<img src="${img}" style="width:200px; margin:5px;">`);
                    });
                }
            });
        }

        setInterval(loadImages, 5000);
    </script>
</body>
</html>
